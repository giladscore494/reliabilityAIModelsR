<!DOCTYPE html>
<html lang="he" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yedaarechevAI - ×× ×•×¢ ×”××œ×¦×•×ª ×¨×›×‘</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #0F172A;
            --text-light: #E2E8F0;
            --primary: #6366F1;
            --secondary: #EC4899;
        }
        body {
            font-family: 'Heebo', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            overflow-x: hidden;
        }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }

        .loader {
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366F1',
                        secondary: '#EC4899',
                        dark: '#0F172A',
                        'dark-lighter': '#1E293B',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                    },
                    boxShadow: {
                        neon: '0 0 20px rgba(99, 102, 241, 0.4)'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark text-slate-200 min-h-screen flex flex-col antialiased selection:bg-primary/30 selection:text-white">

    <!-- HEADER ×–×”×” ×œ××™× ×“×§×¡ -->
    <header class="sticky top-0 z-50 bg-dark/80 backdrop-blur-lg border-b border-slate-800/80 supports-[backdrop-filter]:bg-dark/60">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <a href="{{ url_for('index') }}"
               class="flex items-center space-x-2 space-x-reverse group transition duration-300">
                <h1 class="text-2xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-primary via-purple-500 to-secondary">
                    yedaarechevAI
                </h1>
            </a>

            <div class="flex items-center gap-3 sm:gap-6 text-sm font-medium">
                {% if user and user.is_authenticated %}
                    <div class="hidden md:flex items-center gap-2 text-slate-400">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                  d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                  clip-rule="evenodd"/>
                        </svg>
                        <span>{{ user.name.split(' ')[0] if user.name else '××•×¨×—' }}</span>
                    </div>

                    <!-- ×“×©×‘×•×¨×“ -->
                    <a href="{{ url_for('dashboard') }}"
                       class="relative px-5 py-2.5 rounded-full bg-slate-800/80 hover:bg-slate-700 text-white border border-slate-700/50 transition-all hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0">
                        ×”×—×™×¤×•×©×™× ×©×œ×™
                    </a>

                    <!-- ×× ×•×¢ ×”××œ×¦×•×ª â€“ ××•×“×’×© (××ª×” ×‘×“×£ ×”×–×”) -->
                    <a href="{{ url_for('recommendations') }}"
                       class="relative px-5 py-2.5 rounded-full bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white border border-transparent transition-all hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0">
                        ×× ×•×¢ ×”××œ×¦×•×ª
                    </a>

                    <!-- ×”×ª× ×ª×§×•×ª -->
                    <a href="{{ url_for('logout') }}"
                       class="px-4 py-2 rounded-full text-slate-300 hover:text-white hover:bg-white/10 transition-all flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                        </svg>
                        <span class="hidden sm:inline">×”×ª× ×ª×§</span>
                    </a>
                {% else %}
                    <a href="{{ url_for('login') }}"
                       class="px-6 py-2.5 rounded-full font-bold bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 transition-all text-white shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-0.5 active:translate-y-0">
                        ×”×ª×—×‘×¨×•×ª
                    </a>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- MAIN -->
    <main class="flex-grow relative container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24 flex flex-col items-center overflow-hidden">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] opacity-20 pointer-events-none"
             style="background: radial-gradient(circle, rgba(99,102,241,0.3) 0%, rgba(15,23,42,0) 70%);">
        </div>

        <!-- ×›×•×ª×¨×ª -->
        <div class="relative z-10 text-center max-w-4xl mx-auto mb-16 fade-in">
            <h2 class="text-4xl md:text-6xl font-extrabold text-white mb-6 leading-tight tracking-tight">
                ×× ×•×¢ ×”××œ×¦×•×ª ×¨×›×‘ ×—×›×
                <span class="relative inline-block">
                    <span class="absolute inset-0 bg-gradient-to-r from-primary to-secondary blur-2xl opacity-30"></span>
                    <span class="relative text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">
                        ×¢×œ ×‘×¡×™×¡ Gemini 3 + ×—×™×¤×•×© ×¨×©×ª
                    </span>
                </span>
            </h2>
            <p class="text-lg md:text-2xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
                ×”×’×“×¨ ×¤×¨×•×¤×™×œ × ×”×’ ××œ× â€“ ×”××¢×¨×›×ª ×ª×‘× ×” ×¢×‘×•×¨×š ×¨×©×™××ª ×¨×›×‘×™× ××•××œ×¦×™× ×œ×¤×™ ×ª×§×¦×™×‘, ×©×™××•×©, ×××™× ×•×ª ×•×¢×œ×•×ª ×©× ×ª×™×ª ××©×•×¢×¨×ª.
            </p>
        </div>

        <!-- ×›×¨×˜×™×¡ ××¨×›×–×™ -->
        <div class="relative z-10 w-full max-w-5xl bg-dark-lighter/60 backdrop-blur-xl border border-slate-700/50 p-6 md:p-10 rounded-[2.5rem] shadow-2xl fade-in delay-100">
            <div class="absolute inset-0 rounded-[2.5rem] border-2 border-transparent bg-gradient-to-br from-primary/20 via-transparent to-secondary/20 pointer-events-none"></div>

            <div class="relative z-10 space-y-6">
                {% if not is_owner %}
                    <!-- ××¦×‘: ×œ× ×‘×¢×œ ×”××ª×¨ â€“ ×”×•×“×¢×ª × ×™×¡×•×™ -->
                    <section class="space-y-4">
                        <h3 class="text-2xl font-bold text-white">×”××•×“×•×œ ×¢×“×™×™×Ÿ ×‘×’×¨×¡×ª × ×™×¡×•×™ ×¤× ×™××™×ª</h3>
                        <p class="text-sm text-slate-300">
                            ×× ×•×¢ ×”×”××œ×¦×•×ª ×–××™×Ÿ ×›×¨×’×¢ ×¨×§ ×œ×‘×¢×œ ×”××¢×¨×›×ª ×œ×¦×•×¨×š ×‘×“×™×§×•×ª ×•×›×™×•×œ. ×‘×”×©×§×” ×”×¨×©××™×ª ×›×œ ××©×ª××© ×™×•×›×œ ×œ×”×–×™×Ÿ
                            ×¤×¨×•×¤×™×œ ×©×™××•×©, ×ª×§×¦×™×‘ ×•×”×¢×“×¤×•×ª â€“ ×•×œ×§×‘×œ ×¨×©×™××ª ×¨×›×‘×™× ××•××œ×¦×ª ×œ×©×•×§ ×”×™×©×¨××œ×™.
                        </p>
                    </section>
                {% else %}
                    {% if not user or not user.is_authenticated %}
                        <!-- ××—×™×™×‘ ×”×ª×—×‘×¨×•×ª ×§×•×“× (×œ×™×ª×¨ ×‘×™×˜×—×•×Ÿ) -->
                        <div class="text-center py-10 space-y-6">
                            <div class="relative inline-block">
                                <div class="absolute inset-0 bg-primary/30 blur-3xl rounded-full"></div>
                                <div class="relative bg-dark-lighter p-6 rounded-3xl border border-slate-700/50 shadow-xl">
                                    <span class="text-6xl filter drop-shadow-lg">ğŸ”</span>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-white">× ×“×¨×© ×œ×”×ª×—×‘×¨ ×›×“×™ ×œ×”×©×ª××© ×‘×× ×•×¢ ×”×”××œ×¦×•×ª</h3>
                            <p class="text-slate-400 text-base max-w-md mx-auto">
                                ×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ ×©×œ×š ×›×“×™ ×œ×”×¨×™×¥ ×¤×¨×•×¤×™×œ × ×”×’ ××œ× ×•×œ×§×‘×œ ×¨×©×™××ª ×¨×›×‘×™× ××•×ª×××ª ××™×©×™×ª.
                            </p>
                            <a href="{{ url_for('login') }}"
                               class="group relative inline-flex items-center justify-center px-10 py-4 text-lg font-bold text-white transition-all duration-300 bg-gradient-to-r from-primary to-secondary rounded-2xl hover:scale-[1.03] hover:shadow-neon active:scale-95 overflow-hidden">
                                ×”×ª×—×‘×¨×•×ª ××”×™×¨×”
                            </a>
                        </div>
                    {% else %}
                        <!-- ×˜×•×¤×¡ ×× ×•×¢ ×”××œ×¦×•×ª â€“ ×œ×‘×¢×œ ×”××ª×¨ ×”××—×•×‘×¨ -->
                        <section class="space-y-6">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 border-b border-slate-700/60 pb-4">
                                <div>
                                    <h3 class="text-xl md:text-2xl font-bold text-white">×˜×•×¤×¡ ×”×’×“×¨×ª ×¤×¨×•×¤×™×œ × ×”×’</h3>
                                    <p class="text-xs text-slate-400">
                                        ×”× ×ª×•× ×™× × ×©×œ×—×™× ××œ
                                        <span class="font-semibold">/advisor_api</span>
                                        ×•×× ×•×ª×—×™× ×¢×´×™ Gemini 3 + Google Search.
                                    </p>
                                </div>
                                <button
                                    id="advisor-submit-btn"
                                    class="inline-flex items-center justify-center rounded-2xl bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white text-sm md:text-base px-5 py-3 font-semibold shadow-lg shadow-primary/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                                    ğŸš— ×§×‘×œ ×”××œ×¦×•×ª
                                </button>
                            </div>

                            <!-- ×”×•×“×¢×ª ×¡×˜×˜×•×¡ -->
                            <div id="advisor-status" class="hidden text-xs rounded-xl px-3 py-2 mt-1"></div>

                            <!-- ×˜×•×¤×¡ (× ××¡×£ ×‘-JS ×‘×œ×‘×“) -->
                            <form id="advisor-form" class="space-y-6" onsubmit="return false;">
                                <!-- ×ª×§×¦×™×‘ + ×©× ×ª×•× ×™× -->
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×ª×§×¦×™×‘ ××™× ×™××•× (â‚ª)</label>
                                        <input id="budget_min" type="number" value="40000" min="0"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary transition">
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×ª×§×¦×™×‘ ××§×¡×™××•× (â‚ª)</label>
                                        <input id="budget_max" type="number" value="65000" min="0"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary transition">
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×©× ×ª×•×Ÿ ××™× ×™××•×</label>
                                            <input id="year_min" type="number" value="2015" min="1990"
                                                   class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary transition">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×©× ×ª×•×Ÿ ××§×¡×™××•×</label>
                                            <input id="year_max" type="number" value="2019" min="1990"
                                                   class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary transition">
                                        </div>
                                    </div>
                                </div>

                                <!-- ×“×œ×§ / ×’×™×¨ / ×˜×•×¨×‘×• -->
                                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¡×•×’×™ ×“×œ×§ ××•×¢×“×¤×™×</label>
                                        <div class="flex flex-wrap gap-2 text-xs text-slate-200">
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="fuel-input rounded border-slate-600 bg-slate-900/60" value="×‘× ×–×™×Ÿ" checked>
                                                <span>×‘× ×–×™×Ÿ</span>
                                            </label>
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="fuel-input rounded border-slate-600 bg-slate-900/60" value="×”×™×‘×¨×™×“×™">
                                                <span>×”×™×‘×¨×™×“×™</span>
                                            </label>
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="fuel-input rounded border-slate-600 bg-slate-900/60" value="×“×™×–×œ">
                                                <span>×“×™×–×œ</span>
                                            </label>
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="fuel-input rounded border-slate-600 bg-slate-900/60" value="×—×©××œ×™">
                                                <span>×—×©××œ×™</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×ª×™×‘×ª ×”×™×œ×•×›×™×</label>
                                        <div class="flex flex-wrap gap-2 text-xs text-slate-200">
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="gear-input rounded border-slate-600 bg-slate-900/60" value="××•×˜×•××˜×™×ª" checked>
                                                <span>××•×˜×•××˜×™×ª</span>
                                            </label>
                                            <label class="inline-flex items-center gap-1">
                                                <input type="checkbox" class="gear-input rounded border-slate-600 bg-slate-900/60" value="×™×“× ×™×ª">
                                                <span>×™×“× ×™×ª</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×˜×•×¨×‘×•</label>
                                        <select id="turbo_choice_he"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                            <option selected>×œ× ××©× ×”</option>
                                            <option>×›×Ÿ</option>
                                            <option>×œ×</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ×©×™××•×© ×•×¡×’× ×•×Ÿ -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <label class="block text-xs mb-1 text-slate-300">×ª×™××•×¨ ×”×©×™××•×© ×‘×¨×›×‘</label>
                                        <textarea id="main_use" rows="2"
                                                  class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">× ×¡×™×¢×” ×™×•××™×•××™×ª ×œ×¢×‘×•×“×” ×•×˜×™×•×œ×™× ×§×¦×¨×™×</textarea>
                                    </div>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">× ×¡×•×¢×” ×©× ×ª×™×ª (×§×´×)</label>
                                            <input id="annual_km" type="number" value="15000" min="0" step="1000"
                                                   class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×’×™×œ × ×”×’</label>
                                            <input id="driver_age" type="number" value="21" min="16" max="100"
                                                   class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                        </div>
                                    </div>
                                </div>

                                <!-- ×¡×’× ×•×Ÿ × ×”×™×’×” / ××¨×›×‘ / ××•×©×‘×™× -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¡×’× ×•×Ÿ ××¨×›×‘ ××•×¢×“×£</label>
                                        <select id="body_style"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                            <option selected>×›×œ×œ×™</option>
                                            <option>×¡×“××Ÿ</option>
                                            <option>×”××¦'×‘×§</option>
                                            <option>×§×¨×•×¡××•×‘×¨/×’'×™×¤×•×Ÿ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¡×’× ×•×Ÿ × ×”×™×’×”</label>
                                        <select id="driving_style"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                            <option selected>×¨×’×•×¢ ×•× ×™× ×•×—</option>
                                            <option>×“×™× ××™ ×•×¡×¤×•×¨×˜×™×‘×™</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">××¡×¤×¨ ××§×•××•×ª</label>
                                        <select id="seats_choice"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white focus:outline-none focus:ring-2 focus:ring-primary/40 focus:border-primary">
                                            <option>4</option>
                                            <option selected>5</option>
                                            <option>5+</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ×¡×“×¨ ×¢×“×™×¤×•×™×•×ª -->
                                <div class="border border-slate-700 rounded-2xl p-3 bg-slate-900/40">
                                    <p class="text-xs font-medium text-slate-200 mb-2">×¡×“×¨ ×¢×“×™×¤×•×™×•×ª (1â€“5)</p>
                                    <div class="grid grid-cols-1 sm:grid-cols-5 gap-2">
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×××™× ×•×ª</label>
                                            <input id="weight_reliability" type="number" min="1" max="5" value="5"
                                                   class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-2 py-1.5 text-xs text-center text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×©××™×¨×ª ×¢×¨×š</label>
                                            <input id="weight_resale" type="number" min="1" max="5" value="3"
                                                   class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-2 py-1.5 text-xs text-center text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×—×™×¡×›×•×Ÿ ×‘×“×œ×§</label>
                                            <input id="weight_fuel" type="number" min="1" max="5" value="4"
                                                   class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-2 py-1.5 text-xs text-center text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">×‘×™×¦×•×¢×™×</label>
                                            <input id="weight_performance" type="number" min="1" max="5" value="2"
                                                   class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-2 py-1.5 text-xs text-center text-white">
                                        </div>
                                        <div>
                                            <label class="block text-xs mb-1 text-slate-300">× ×•×—×•×ª</label>
                                            <input id="weight_comfort" type="number" min="1" max="5" value="3"
                                                   class="w-full rounded-xl bg-slate-900/60 border border-slate-700 px-2 py-1.5 text-xs text-center text-white">
                                        </div>
                                    </div>
                                </div>

                                <!-- ××©×¤×—×” / ××˜×¢×Ÿ / ×‘×˜×™×—×•×ª / ××‘×–×•×¨ -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×’×•×“×œ ××©×¤×—×”</label>
                                        <select id="family_size"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option>1-2</option>
                                            <option selected>3-4</option>
                                            <option>5+</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¦×•×¨×š ×‘×ª× ××˜×¢×Ÿ</label>
                                        <select id="cargo_need"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option>×§×˜×Ÿ</option>
                                            <option selected>×‘×™× ×•× ×™</option>
                                            <option>×’×“×•×œ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×—×•×‘×” ×‘×˜×™×—×•×ª ××§×˜×™×‘×™×ª?</label>
                                        <select id="safety_required"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option selected>×›×Ÿ</option>
                                            <option>×œ×</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¨××ª ××‘×–×•×¨</label>
                                        <select id="trim_level"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option>×‘×¡×™×¡×™</option>
                                            <option selected>×¡×˜× ×“×¨×˜×™</option>
                                            <option>×¢×©×™×¨</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ×‘×™×˜×•×— / ×¢×‘×¨ × ×”×™×’×” -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×•×•×ª×§ ×¨×™×©×™×•×Ÿ (×©× ×™×)</label>
                                        <input id="license_years" type="number" min="0" max="50" value="2"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">××™×Ÿ × ×”×’</label>
                                        <select id="driver_gender"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option selected>×–×›×¨</option>
                                            <option>× ×§×‘×”</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¢×‘×¨ ×‘×™×˜×•×—×™</label>
                                        <input id="insurance_history" type="text" value="×©× ×ª×™×™× ×œ×œ× ×ª×‘×™×¢×•×ª"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×“×•×—×•×ª / ×©×œ×™×œ×•×ª</label>
                                        <select id="violations"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option selected>××™×Ÿ</option>
                                            <option>×©×œ×™×œ×” ×‘×¢×‘×¨</option>
                                            <option>× ×§×•×“×•×ª ×¤×¢×™×œ×•×ª</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×”×ª×—×©×‘×•×ª ×‘×”×™×¦×¢ ×‘×©×•×§</label>
                                        <select id="consider_supply"
                                                class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                            <option selected>×›×Ÿ</option>
                                            <option>×œ×</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">×¦×‘×¢×™× ×œ×¤×¡×™×œ×” (××•×¤×¨×“×™× ×‘×¤×¡×™×§)</label>
                                        <input id="excluded_colors" type="text" placeholder="×œ××©×œ: ×©×—×•×¨, ×œ×‘×Ÿ"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white placeholder-slate-500">
                                    </div>
                                </div>

                                <!-- ××—×™×¨×™ ×“×œ×§ / ×—×©××œ -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">××—×™×¨ ×œ×™×˜×¨ ×“×œ×§ (â‚ª)</label>
                                        <input id="fuel_price" type="number" step="0.1" min="1" max="20" value="7"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                    </div>
                                    <div>
                                        <label class="block text-xs mb-1 text-slate-300">××—×™×¨ ×—×©××œ ×œ×§×•×˜×´×© (â‚ª)</label>
                                        <input id="electricity_price" type="number" step="0.01" min="0.1" max="5" value="0.65"
                                               class="w-full rounded-xl bg-slate-900/50 border border-slate-700 px-3 py-2 text-sm text-white">
                                    </div>
                                </div>
                            </form>
                        </section>

                        <!-- ×ª×•×¦××•×ª -->
                        <section class="mt-8 space-y-4">
                            <div id="advisor-search-info"
                                 class="hidden bg-slate-900/80 text-slate-100 rounded-2xl p-4 text-xs space-y-2 border border-slate-700">
                                <div class="font-semibold">×¡×˜×˜×•×¡ ×—×™×¤×•×© ×¨×©×ª</div>
                                <pre id="advisor-search-queries" class="whitespace-pre-wrap text-[11px] leading-relaxed"></pre>
                            </div>

                            <div id="advisor-results" class="space-y-3"></div>
                        </section>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </main>

    <!-- FOOTER ×›××• ×‘××™× ×“×§×¡ -->
    <footer class="mt-24 py-10 text-center border-t border-slate-800/50 bg-dark-lighter/30 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-3 opacity-75 hover:opacity-100 transition-opacity">
                <span class="font-bold text-white">yedaarechevAI</span>
            </div>
            <p class="text-slate-500 text-sm">Â© 2025 ×™×“×¢ ×¨×›×‘.</p>
            <div class="flex gap-6 text-sm font-medium">
                <a href="{{ url_for('privacy') }}" class="text-slate-400 hover:text-primary transition-colors">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a>
                <a href="{{ url_for('terms') }}" class="text-slate-400 hover:text-primary transition-colors">×ª×§× ×•×Ÿ ×©×™××•×©</a>
            </div>
        </div>
    </footer>

    <!-- ×× ×™×© script.js ×›×œ×œ×™, ×›××• ×‘××™× ×“×§×¡ -->
    <script src="/static/script.js"></script>

    <!-- JS ×©×œ ×× ×•×¢ ×”×”××œ×¦×•×ª (××•×ª×× ×œ×¦×‘×¢×™× ×›×”×™×) -->
    <script>
    (function() {
        const submitBtn = document.getElementById('advisor-submit-btn');
        const statusBox = document.getElementById('advisor-status');
        const resultsContainer = document.getElementById('advisor-results');
        const searchInfoBox = document.getElementById('advisor-search-info');
        const searchQueriesPre = document.getElementById('advisor-search-queries');

        if (!submitBtn) return; // ××™×Ÿ ×’×™×©×” ×œ×˜×•×¤×¡ (×œ× ×‘×¢×œ ×”××ª×¨ / ×œ× ××—×•×‘×¨)

        function showStatus(text, type) {
            if (!statusBox) return;
            statusBox.classList.remove('hidden');
            statusBox.textContent = text || '';
            statusBox.className =
                'text-xs rounded-xl px-3 py-2 mt-2 ' +
                (type === 'error'
                    ? 'bg-red-950/40 text-red-200 border border-red-500/50'
                    : type === 'ok'
                        ? 'bg-emerald-950/40 text-emerald-200 border border-emerald-500/40'
                        : 'bg-slate-900/60 text-slate-100 border border-slate-700/60');
        }

        function clearResults() {
            if (resultsContainer) {
                resultsContainer.innerHTML = '';
            }
            if (searchInfoBox && searchQueriesPre) {
                searchInfoBox.classList.add('hidden');
                searchQueriesPre.textContent = '';
            }
        }

        function val(id) {
            const el = document.getElementById(id);
            return el ? el.value : '';
        }

        function collectValues() {
            const budget_min = parseFloat(val('budget_min') || '0');
            const budget_max = parseFloat(val('budget_max') || '0');
            const year_min = parseInt(val('year_min') || '2015', 10);
            const year_max = parseInt(val('year_max') || '2019', 10);

            const fuels_he = Array.from(document.querySelectorAll('.fuel-input:checked')).map(x => x.value);
            const gears_he = Array.from(document.querySelectorAll('.gear-input:checked')).map(x => x.value);
            const turbo_choice_he = val('turbo_choice_he') || '×œ× ××©× ×”';

            const weights = {
                reliability: parseInt(val('weight_reliability') || '5', 10),
                resale: parseInt(val('weight_resale') || '3', 10),
                fuel: parseInt(val('weight_fuel') || '4', 10),
                performance: parseInt(val('weight_performance') || '2', 10),
                comfort: parseInt(val('weight_comfort') || '3', 10),
            };

            const excluded_colors_raw = val('excluded_colors') || '';
            const excluded_colors = excluded_colors_raw
                .split(',')
                .map(s => s.trim())
                .filter(Boolean);

            return {
                budget_min,
                budget_max,
                year_min,
                year_max,
                fuels_he,
                gears_he,
                turbo_choice_he,
                main_use: val('main_use'),
                annual_km: parseInt(val('annual_km') || '15000', 10),
                driver_age: parseInt(val('driver_age') || '21', 10),
                body_style: val('body_style'),
                driving_style: val('driving_style'),
                seats_choice: val('seats_choice'),
                weights: weights,
                family_size: val('family_size'),
                cargo_need: val('cargo_need'),
                safety_required: val('safety_required'),
                trim_level: val('trim_level'),
                license_years: parseInt(val('license_years') || '2', 10),
                driver_gender: val('driver_gender'),
                insurance_history: val('insurance_history'),
                violations: val('violations'),
                consider_supply: val('consider_supply'),
                excluded_colors: excluded_colors,
                fuel_price: parseFloat(val('fuel_price') || '7'),
                electricity_price: parseFloat(val('electricity_price') || '0.65'),
            };
        }

        function formatNIS(num) {
            if (num === null || num === undefined || num === '') return '';
            const n = Number(num);
            if (isNaN(n)) return String(num);
            return n.toLocaleString('he-IL', { maximumFractionDigits: 0 });
        }

        function renderResults(data) {
            clearResults();

            if (data.error) {
                showStatus(data.error, 'error');
                return;
            }

            const cars = Array.isArray(data.recommended_cars) ? data.recommended_cars : [];

            if (!cars.length) {
                showStatus('×œ× ×”×ª×§×‘×œ×• ×¨×›×‘×™× ××ª××™××™× ××”××•×“×œ.', 'error');
                return;
            }

            if (Array.isArray(data.search_queries) && data.search_queries.length > 0 && searchInfoBox && searchQueriesPre) {
                searchInfoBox.classList.remove('hidden');
                searchQueriesPre.textContent = data.search_queries.join('\n');
            }

            cars.forEach((car) => {
                const card = document.createElement('div');
                card.className =
                    'bg-dark-lighter/80 border border-slate-700 rounded-2xl p-4 shadow-md flex flex-col gap-2 text-xs sm:text-sm text-slate-200';

                const brand = car.brand || '';
                const model = car.model || '';
                const year = car.year || '';

                const fuel = car.fuel || '';
                const gear = car.gear || '';
                const turbo = (car.turbo !== undefined && car.turbo !== null) ? car.turbo : '';

                const priceRange = car.price_range_nis || '';
                const reliability = car.reliability_score ?? '';
                const resale = car.resale_value ?? '';
                const totalAnnual =
                    car.total_annual_cost !== undefined && car.total_annual_cost !== null
                        ? formatNIS(car.total_annual_cost) + ' â‚ª'
                        : '';

                const fitScore = car.fit_score ?? '';

                const title = document.createElement('div');
                title.className = 'flex items-center justify-between gap-2';

                const name = document.createElement('div');
                name.className = 'font-semibold text-slate-50';
                name.textContent = `${brand} ${model} ${year}`.trim();

                const fitBadge = document.createElement('div');
                fitBadge.className =
                    'inline-flex items-center gap-1 rounded-full bg-gradient-to-r from-primary to-secondary text-white text-[11px] px-3 py-1';
                fitBadge.textContent = fitScore !== '' ? `×”×ª×××”: ${fitScore}/100` : '×”×ª×××”';

                title.appendChild(name);
                title.appendChild(fitBadge);

                const meta = document.createElement('div');
                meta.className = 'text-[11px] text-slate-400 flex flex-wrap gap-x-3 gap-y-1';
                meta.innerHTML = `
                    <span>×“×œ×§: <span class="font-medium text-slate-200">${fuel}</span></span>
                    <span>|</span>
                    <span>×’×™×¨: <span class="font-medium text-slate-200">${gear}</span></span>
                    <span>|</span>
                    <span>×˜×•×¨×‘×•: <span class="font-medium text-slate-200">${turbo}</span></span>
                `;

                const mainRow = document.createElement('div');
                mainRow.className = 'grid grid-cols-2 sm:grid-cols-4 gap-2 text-[11px] text-slate-300';
                mainRow.innerHTML = `
                    <div>×˜×•×•×— ××—×™×¨: <span class="font-medium text-slate-100">${priceRange}</span></div>
                    <div>×¢×œ×•×ª ×©× ×ª×™×ª: <span class="font-medium text-slate-100">${totalAnnual}</span></div>
                    <div>×××™× ×•×ª: <span class="font-medium text-slate-100">${reliability}</span>${reliability !== '' ? '/10' : ''}</div>
                    <div>×©××™×¨×ª ×¢×¨×š: <span class="font-medium text-slate-100">${resale}</span>${resale !== '' ? '/10' : ''}</div>
                `;

                const extra = document.createElement('details');
                extra.className = 'mt-2 rounded-xl bg-slate-900/60 px-3 py-2 border border-slate-700/70';

                const summary = document.createElement('summary');
                summary.className = 'cursor-pointer text-[11px] text-slate-100 font-medium';
                summary.textContent = '×”×¡×‘×¨ ××œ× ×•×©×™×˜×•×ª ×—×™×©×•×‘';
                extra.appendChild(summary);

                const extraContent = document.createElement('div');
                extraContent.className = 'mt-2 space-y-1 text-[11px] text-slate-200';

                if (car.annual_energy_cost !== undefined && car.annual_energy_cost !== null) {
                    const energy = document.createElement('div');
                    energy.textContent = `×¢×œ×•×ª ×× ×¨×’×™×” ××©×•×¢×¨×ª ×œ×©× ×”: ${formatNIS(car.annual_energy_cost)} â‚ª`;
                    extraContent.appendChild(energy);
                }

                if (car.performance_score !== undefined && car.performance_score !== null) {
                    const perf = document.createElement('div');
                    perf.textContent = `×‘×™×¦×•×¢×™×: ${car.performance_score}/10`;
                    extraContent.appendChild(perf);
                }
                if (car.safety_rating !== undefined && car.safety_rating !== null) {
                    const saf = document.createElement('div');
                    saf.textContent = `×‘×˜×™×—×•×ª: ${car.safety_rating}/10`;
                    extraContent.appendChild(saf);
                }
                if (car.comfort_features !== undefined && car.comfort_features !== null) {
                    const comf = document.createElement('div');
                    comf.textContent = `× ×•×—×•×ª: ${car.comfort_features}/10`;
                    extraContent.appendChild(comf);
                }
                if (car.suitability !== undefined && car.suitability !== null) {
                    const suit = document.createElement('div');
                    suit.textContent = `×”×ª×××” ×›×œ×œ×™×ª: ${car.suitability}/10`;
                    extraContent.appendChild(suit);
                }

                if (car.comparison_comment) {
                    const cmp = document.createElement('div');
                    cmp.className = 'mt-2';
                    cmp.textContent = car.comparison_comment;
                    extraContent.appendChild(cmp);
                }
                if (car.not_recommended_reason) {
                    const warn = document.createElement('div');
                    warn.className = 'mt-1 text-amber-300';
                    warn.textContent = '×”×¢×¨×ª ×–×”×™×¨×•×ª: ' + car.not_recommended_reason;
                    extraContent.appendChild(warn);
                }

                const methodEntries = Object.entries(car).filter(([k, v]) => k.endsWith('_method') && v);
                if (methodEntries.length > 0) {
                    const methodsTitle = document.createElement('div');
                    methodsTitle.className = 'mt-2 font-semibold text-[11px] text-slate-100';
                    methodsTitle.textContent = '×©×™×˜×•×ª ×—×™×©×•×‘ (×œ×¤×™ Gemini):';
                    extraContent.appendChild(methodsTitle);

                    methodEntries.forEach(([k, v]) => {
                        const row = document.createElement('div');
                        row.textContent = k + ': ' + v;
                        extraContent.appendChild(row);
                    });
                }

                extra.appendChild(extraContent);

                card.appendChild(title);
                card.appendChild(meta);
                card.appendChild(mainRow);
                card.appendChild(extra);

                resultsContainer.appendChild(card);
            });
        }

        submitBtn.addEventListener('click', function() {
            clearResults();
            const payload = collectValues();

            if (!payload.budget_min || !payload.budget_max || payload.budget_max < payload.budget_min) {
                showStatus('×‘×“×•×§ ××ª ×˜×•×•×— ×”×ª×§×¦×™×‘.', 'error');
                return;
            }

            showStatus('×©×•×œ×— ×‘×§×©×” ×œ-Gemini 3 + ×—×™×¤×•×© ×¨×©×ª...', 'info');
            submitBtn.disabled = true;

            fetch('{{ url_for("advisor_api") }}', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'same-origin',
                body: JSON.stringify(payload)
            })
            .then(async (res) => {
                const data = await res.json().catch(() => ({}));
                if (!res.ok || data.error) {
                    const errMsg = data.error || '×©×’×™××” ×›×œ×œ×™×ª ××”×©×¨×ª.';
                    showStatus(errMsg, 'error');
                    submitBtn.disabled = false;
                    return;
                }
                showStatus('âœ… ×”×ª×§×‘×œ×• ×ª×•×¦××•×ª. ××¦×™×’ ×¨×›×‘×™× ××•××œ×¦×™×...', 'ok');
                renderResults(data);
                submitBtn.disabled = false;
            })
            .catch((err) => {
                console.error(err);
                showStatus('×©×’×™××” ×‘×¨××ª ×¨×©×ª ××• ×“×¤×“×¤×Ÿ.', 'error');
                submitBtn.disabled = false;
            });
        });
    })();
    </script>
</body>
</html>
