<!DOCTYPE html>
<html lang="he" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸš— Car Reliability Analyzer - ×‘×“×™×§×ª ×××™× ×•×ª ×¨×›×‘ ×‘-AI</title>

  <!-- TailwindCSS ×™×¦×™×‘ -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>

  <!-- Heebo -->
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet"/>

  <style>
    :root { --bg-dark:#0F172A; --text-light:#E2E8F0; }
    body {
      font-family:'Heebo',system-ui,-apple-system,sans-serif;
      background-color:var(--bg-dark);
      color:var(--text-light);
      margin:0;
      overflow-x:hidden;
    }
    .fade-in { animation:fadeIn .6s cubic-bezier(.4,0,.2,1) forwards; opacity:0; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    .loader {
      border:3px solid rgba(255,255,255,.2);
      border-top-color:#6366F1; border-radius:50%;
      width:1.5rem;height:1.5rem; animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg) } }
    ::-webkit-scrollbar{width:10px}
    ::-webkit-scrollbar-track{background:#1e293b}
    ::-webkit-scrollbar-thumb{background:#475569;border-radius:5px}
    ::-webkit-scrollbar-thumb:hover{background:#64748b}
  </style>

  <script>
    /* Tailwind config */
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: { DEFAULT:'#6366F1', 50:'#eef2ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81' },
            secondary: { DEFAULT:'#EC4899', 50:'#fdf2f8',100:'#fce7f3',200:'#fbcfe8',300:'#f9a8d4',400:'#f472b6',500:'#ec4899',600:'#db2777',700:'#be185d',800:'#9d174d',900:'#831843' },
            dark:'#0F172A', 'dark-lighter':'#1E293B'
          },
          boxShadow: { neon:'0 0 20px rgba(99,102,241,.4)' }
        }
      }
    }
  </script>
</head>

<body class="bg-dark text-slate-200 min-h-screen flex flex-col antialiased selection:bg-primary/30 selection:text-white">

  <!-- NAVBAR -->
  <header class="sticky top-0 z-50 bg-dark/80 backdrop-blur-lg border-b border-slate-800/80 supports-[backdrop-filter]:bg-dark/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <a href="/" class="flex items-center space-x-2 space-x-reverse group transition duration-300">
        <span class="text-3xl filter drop-shadow-lg group-hover:scale-110 transition-transform">ğŸš—</span>
        <h1 class="text-2xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-primary via-purple-500 to-secondary">
          CarAnalyzer.AI
        </h1>
      </a>

      <div class="flex items-center gap-3 sm:gap-6 text-sm font-medium">
        {% if current_user.is_authenticated %}
          <div class="hidden md:flex items-center gap-2 text-slate-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/></svg>
            <span>{{ current_user.name.split(' ')[0] if current_user.name else '××•×¨×—' }}</span>
          </div>
          <a href="/dashboard" class="relative px-5 py-2.5 rounded-full bg-slate-800/80 hover:bg-slate-700 text-white border border-slate-700/50 transition-all hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0">
            ×”×—×™×¤×•×©×™× ×©×œ×™
            <span class="absolute -top-1 -right-1 flex h-3 w-3">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
              <span class="relative inline-flex rounded-full h-3 w-3 bg-primary"></span>
            </span>
          </a>
          <a href="/logout" class="hidden sm:inline-block text-slate-400 hover:text-white transition-colors">×”×ª× ×ª×§</a>
        {% else %}
          <a href="/login" class="px-6 py-2.5 rounded-full font-bold bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 transition-all text-white shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-0.5 active:translate-y-0">
            ×”×ª×—×‘×¨×•×ª
          </a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-grow relative container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24 flex flex-col items-center overflow-hidden">
    <!-- Background halo -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[1000px] opacity-20 pointer-events-none"
         style="background: radial-gradient(circle, rgba(99,102,241,0.3) 0%, rgba(15,23,42,0) 70%);"></div>

    <!-- Hero -->
    <div class="relative z-10 text-center max-w-4xl mx-auto mb-16 fade-in">
      <span class="inline-block py-1 px-3 rounded-full bg-slate-800/50 border border-slate-700 text-primary text-sm font-semibold mb-5">
        âœ¨ ×× ×•×¢ AI ×—×“×©: ×’×¨×¡×” 2.0 ×–××™× ×” ×›×¢×ª
      </span>
      <h2 class="text-5xl md:text-7xl font-extrabold text-white mb-8 leading-tight tracking-tight">
        ××œ ×ª×§× ×” ×¨×›×‘ ×œ×¤× ×™ ×©×ª×“×¢ ××ª
        <span class="relative inline-block">
          <span class="absolute inset-0 bg-gradient-to-r from-primary to-secondary blur-2xl opacity-30"></span>
          <span class="relative text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">×”×××ª ×”××œ××”</span>
        </span>
      </h2>
      <p class="text-xl md:text-2xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
        × ×™×ª×•×— ×××™× ×•×ª ××¢××™×§ ×”××‘×•×¡×¡ ×¢×œ ××™×œ×™×•× ×™ × ×ª×•× ×™×, ××•×ª×× ×‘××™×•×—×“ ×œ×©×•×§ ×”×¨×›×‘ ×”×™×©×¨××œ×™ ×•×œ×ª× ××™ ×”××¨×¥.
      </p>
    </div>

    <!-- Tool Card -->
    <div class="relative z-10 w-full max-w-4xl bg-dark-lighter/60 backdrop-blur-xl border border-slate-700/50 p-8 md:p-12 rounded-[2.5rem] shadow-2xl fade-in delay-100">
      <div class="absolute inset-0 rounded-[2.5rem] border-2 border-transparent bg-gradient-to-br from-primary/20 via-transparent to-secondary/20 pointer-events-none"
           style="mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);"></div>

      {% if current_user.is_authenticated %}
      <!-- Logged-in form -->
      <form id="car-form" class="space-y-10">
        <div class="flex items-center space-x-4 space-x-reverse border-b border-slate-700/50 pb-6">
          <div class="bg-gradient-to-br from-primary to-secondary p-3 rounded-2xl shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
          </div>
          <div>
            <h3 class="text-2xl font-bold text-white">××¤×¨×˜ ×”×¨×›×‘ ×œ×‘×“×™×§×”</h3>
            <p class="text-slate-400 text-sm">×× × ××œ× ××ª ×”×¤×¨×˜×™× ×”××“×•×™×§×™× ×‘×™×•×ª×¨ ×œ×§×‘×œ×ª ×ª×•×¦××” ××™×˜×‘×™×ª</p>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Make -->
          <div class="group space-y-3">
            <label for="make" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
              ×™×¦×¨×Ÿ <span class="text-secondary mr-1">*</span>
            </label>
            <div class="relative">
              <select id="make" name="make" required
                      class="w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all hover:border-slate-600 cursor-pointer">
                <option value="">×‘×—×¨ ×™×¦×¨×Ÿ ××”×¨×©×™××”...</option>
                {% if car_models_data %}
                  {% for make in car_models_data.keys()|sort %}
                    <option value="{{ make }}">{{ make }}</option>
                  {% endfor %}
                {% endif %}
              </select>
              <div class="absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500 group-focus-within:text-primary transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
              </div>
            </div>
          </div>

          <!-- Model -->
          <div class="group space-y-3">
            <label for="model" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
              ×“×’× <span class="text-secondary mr-1">*</span>
            </label>
            <div class="relative">
              <select id="model" name="model" required disabled
                      class="w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                <option value="">-- ×§×•×“× ×‘×—×¨ ×™×¦×¨×Ÿ --</option>
              </select>
              <div class="absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
              </div>
            </div>
          </div>

          <!-- Year -->
          <div class="group space-y-3">
            <label for="year" class="flex items-center text-sm font-bold text-slate-300 group-focus-within:text-primary transition-colors">
              ×©× ×ª×•×Ÿ <span class="text-secondary mr-1">*</span>
            </label>
            <div class="relative">
              <select id="year" name="year" required disabled
                      class="w-full appearance-none bg-slate-900/50 border-2 border-slate-700 rounded-xl px-5 py-4 text-white focus:ring-0 focus:border-primary transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                <option value="">-- ×§×•×“× ×‘×—×¨ ×“×’× --</option>
              </select>
              <div class="absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Optional details -->
        <div class="bg-slate-800/30 p-6 rounded-2xl border border-slate-700/50 space-y-6">
          <h4 class="text-lg font-bold text-white flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-primary" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/></svg>
            ×“×™×•×§ × ×ª×•× ×™× (××•×¤×¦×™×•× ×œ×™)
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="space-y-2">
              <label class="text-xs font-bold uppercase tracking-wider text-slate-400">××“ ××•×¥ (×§"×)</label>
              <select id="mileage_range" name="mileage_range" class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                <option>×¢×“ 50,000 ×§"×</option>
                <option>50,000 - 100,000 ×§"×</option>
                <option selected>100,000 - 150,000 ×§"×</option>
                <option>150,000 - 200,000 ×§"×</option>
                <option>××¢×œ 200,000 ×§"×</option>
              </select>
            </div>

            <div class="space-y-2">
              <label class="text-xs font-bold uppercase tracking-wider text-slate-400">×¡×•×’ ×× ×•×¢</label>
              <select id="fuel_type" name="fuel_type" class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                <option selected>×‘× ×–×™×Ÿ</option>
                <option>×“×™×–×œ</option>
                <option>×”×™×‘×¨×™×“×™ (×¨×’×™×œ/×¤×œ××’-××™×Ÿ)</option>
                <option>×—×©××œ×™ ××œ× (BEV)</option>
              </select>
            </div>

            <div class="space-y-2">
              <label class="text-xs font-bold uppercase tracking-wider text-slate-400">×ª×™×‘×ª ×”×™×œ×•×›×™×</label>
              <select id="transmission" name="transmission" class="w-full bg-slate-900/50 border-slate-700 rounded-xl text-sm focus:ring-primary">
                <option selected>××•×˜×•××˜×™×ª (×¤×œ× ×˜×¨×™×ª/×¨×¦×™×¤×”)</option>
                <option>×¨×•×‘×•×˜×™×ª (×›×¤×•×œ×ª ××¦××“×™×)</option>
                <option>×™×“× ×™×ª</option>
              </select>
            </div>
          </div>

          <div class="space-y-2">
            <label for="sub_model" class="text-xs font-bold uppercase tracking-wider text-slate-400">×¨××ª ×’×™××•×¨ / ×ª×ª-×“×’×</label>
            <input type="text" id="sub_model" name="sub_model" placeholder="×œ×“×•×’××”: Premium, Sport, GLI, 1.5 Turbo..."
                   class="w-full bg-slate-900/50 border-slate-700 rounded-xl px-4 py-3 focus:ring-primary focus:border-primary placeholder-slate-600"/>
          </div>
        </div>

        <div class="pt-4 space-y-8">
          <label class="flex items-start gap-4 p-4 rounded-xl bg-slate-800/20 border border-slate-700/50 cursor-pointer group hover:bg-slate-800/40 transition-colors">
            <input type="checkbox" id="legal-confirm" name="legal-confirm" required
                   class="mt-1 w-6 h-6 rounded border-2 border-slate-600 text-primary focus:ring-offset-0 focus:ring-primary bg-slate-900/50 checked:bg-primary transition-colors"/>
            <span class="text-sm text-slate-300 leading-relaxed">
              ×× ×™ ×××©×¨/×ª ×›×™ ×× ×™ ××¢×œ ×’×™×œ 18, ×•×§×¨××ª×™ ×•×”×¡×›××ª×™
              <a href="{{ url_for('terms') }}" target="_blank" class="text-primary font-bold hover:underline underline-offset-4">×œ×ª× ××™ ×”×©×™××•×©</a>
              ×•
              <a href="{{ url_for('privacy') }}" target="_blank" class="text-primary font-bold hover:underline underline-offset-4">××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª</a>.
            </span>
          </label>
          <p id="legal-error" class="hidden flex items-center text-red-400 text-sm bg-red-950/30 border border-red-900/50 p-3 rounded-lg">
            × ×“×¨×© ×œ××©×¨ ××ª ×ª× ××™ ×”×©×™××•×©.
          </p>

          <button type="submit" id="submit-button"
                  class="relative w-full md:w-auto md:min-w-[360px] mx-auto flex items-center justify-center py-5 px-10 bg-gradient-to-r from-primary to-secondary hover:from-primary/110 hover:to-secondary/110 text-white font-black text-xl rounded-2xl shadow-xl shadow-primary/20 transition-all hover:scale-[1.02] active:scale-95 overflow-hidden">
            <span class="button-text relative z-10 flex items-center">ğŸš€ ×”×¤×¢×œ ×× ×•×¢ × ×™×ª×•×— AI</span>
            <div class="spinner hidden relative z-10 mr-3" aria-hidden="true">
              <div class="loader"></div>
            </div>
          </button>
        </div>
      </form>

      {% else %}
      <!-- Logged-out view -->
      <div class="text-center py-8 space-y-8">
        <div class="relative inline-block">
          <div class="absolute inset-0 bg-primary/30 blur-3xl rounded-full"></div>
          <div class="relative bg-dark-lighter p-6 rounded-3xl border border-slate-700/50 shadow-xl">
            <span class="text-7xl filter drop-shadow-lg">ğŸ”’</span>
          </div>
        </div>
        <div>
          <h3 class="text-3xl font-bold text-white mb-4">×’×™×©×” ×œ×—×‘×¨×™ ××•×¢×“×•×Ÿ ×‘×œ×‘×“</h3>
          <p class="text-slate-400 text-lg max-w-md mx-auto">
            ×”×¦×˜×¨×£ ×œ××œ×¤×™ ×™×©×¨××œ×™× ×©×›×‘×¨ ×—×¡×›×• ×›×¡×£ ×•×›××‘ ×¨××©. ×”×”×¨×©××” ×§×¦×¨×” ×•×—×™× ××™×ª.
          </p>
        </div>
        <a href="/login"
           class="group relative inline-flex items-center justify-center px-10 py-5 text-xl font-bold text-white transition-all duration-300 bg-gradient-to-r from-primary to-secondary rounded-2xl hover:scale-[1.03] hover:shadow-neon active:scale-95 overflow-hidden">
          ×”×ª×—×‘×¨×•×ª ××”×™×¨×” ×¢× Google
        </a>
      </div>
      <div class="hidden" aria-hidden="true" style="min-height: 400px;"></div>
      {% endif %}
    </div>

    <!-- Social proof -->
    <div class="mt-32 grid grid-cols-1 md:grid-cols-3 gap-12 max-w-6xl mx-auto text-center fade-in delay-200">
      <div class="group p-8 rounded-3xl bg-dark-lighter/40 border border-slate-700/30 hover:bg-dark-lighter/60 transition-all duration-300 hover:-translate-y-2">
        <div class="inline-flex items-center justify-center w-20 h-20 mb-6 rounded-2xl bg-primary/10 text-primary group-hover:bg-primary group-hover:text-white transition-colors duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
        </div>
        <h3 class="text-2xl font-bold text-white mb-3">×‘×™× ×” ××œ××›×•×ª×™×ª ××ª×§×“××ª</h3>
        <p class="text-slate-400 leading-relaxed">×”××¢×¨×›×ª ××©×œ×‘×ª × ×™×ª×•×— ×—×›× ×•××§×•×¨×•×ª ××™×“×¢ ×¢×“×›× ×™×™×.</p>
      </div>
      <div class="group p-8 rounded-3xl bg-dark-lighter/40 border border-slate-700/30 hover:bg-dark-lighter/60 transition-all duration-300 hover:-translate-y-2">
        <div class="inline-flex items-center justify-center w-20 h-20 mb-6 rounded-2xl bg-secondary/10 text-secondary group-hover:bg-secondary group-hover:text-white transition-colors duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        </div>
        <h3 class="text-2xl font-bold text-white mb-3">××•×ª×× ×œ×™×©×¨××œ</h3>
        <p class="text-slate-400 leading-relaxed">×”×ª×™×™×—×¡×•×ª ×œ××§×œ×™×, ×¢×•××¡×™×, ×“×œ×§ ×•×¢×œ×•×™×•×ª ××§×•××™×•×ª.</p>
      </div>
      <div class="group p-8 rounded-3xl bg-dark-lighter/40 border border-slate-700/30 hover:bg-dark-lighter/60 transition-all duration-300 hover:-translate-y-2">
        <div class="inline-flex items-center justify-center w-20 h-20 mb-6 rounded-2xl bg-green-500/10 text-green-500 group-hover:bg-green-500 group-hover:text-white transition-colors duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        </div>
        <h3 class="text-2xl font-bold text-white mb-3">×—×™×¡×›×•×Ÿ ×›×¡×¤×™ ××©××¢×•×ª×™</h3>
        <p class="text-slate-400 leading-relaxed">×× ×™×¢×ª ×§× ×™×™×ª "×œ×™××•×Ÿ" ×•×—×™×–×•×™ ×ª×—×–×•×§×”.</p>
      </div>
    </div>

    <!-- Results -->
    <div id="results-container" class="hidden w-full max-w-5xl mt-16 fade-in delay-300">
      <div id="results-content" class="bg-dark-lighter/80 backdrop-blur-xl p-8 md:p-12 rounded-[2rem] border border-slate-700/50 shadow-2xl text-slate-200 prose prose-lg prose-invert max-w-none prose-headings:text-white prose-a:text-primary prose-strong:text-white">
        <!-- ×”×ª×•×¦××•×ª ×™×•×–×¨×§×• ×›××Ÿ -->
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="mt-32 py-12 text-center border-t border-slate-800/50 bg-dark-lighter/30 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-6">
      <div class="flex items-center gap-3 opacity-75 hover:opacity-100 transition-opacity">
        <span class="text-2xl">ğŸš—</span>
        <span class="font-bold text-white">CarAnalyzer.AI</span>
      </div>
      <p class="text-slate-500 text-sm">Â© 2025 ×™×“×¢ ×¨×›×‘. ×¤×•×ª×— ×‘×™×©×¨××œ ğŸ‡®ğŸ‡±.</p>
      <div class="flex gap-6 text-sm font-medium">
        <a href="{{ url_for('privacy') }}" class="text-slate-400 hover:text-primary transition-colors">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a>
        <a href="{{ url_for('terms') }}" class="text-slate-400 hover:text-primary transition-colors">×ª×§× ×•×Ÿ ×©×™××•×©</a>
      </div>
    </div>
  </footer>

  <!-- ===== Server data (Jinja -> JS) ===== -->
  <script>
    // ××™×Ÿ ×©×™××•×© ×‘-template literals ×¢× {{ }} ×›×“×™ ×œ×× ×•×¢ ×”×ª× ×’×©×•×ª Jinja.
    const userIsAuthenticated = {{ (current_user.is_authenticated | tojson) if current_user else 'false' }};
    const carModelsData = {{ (car_models_data | tojson) if car_models_data else '{}' }};
  </script>

  <!-- ===== App Logic ===== -->
  <script>
    (function () {
      const makeEl = document.getElementById('make');
      const modelEl = document.getElementById('model');
      const yearEl = document.getElementById('year');

      // ×©××™×¨×”: carModelsData ×¦×¤×•×™ ×‘××‘× ×”:
      // {
      //   "Toyota": {"Corolla": [2017,2018,2019], "RAV4": [2020,2021]},
      //   "Mazda": {"3": [2019,2020]}
      // }
      function clearSelect(select, placeholder) {
        select.innerHTML = '';
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = placeholder;
        select.appendChild(opt);
      }

      function enable(select, flag) {
        if (flag) {
          select.removeAttribute('disabled');
          select.classList.remove('disabled:opacity-50','disabled:cursor-not-allowed');
        } else {
          select.setAttribute('disabled','disabled');
        }
      }

      function populateModelsForMake(make) {
        clearSelect(modelEl, '-- ×§×•×“× ×‘×—×¨ ×™×¦×¨×Ÿ --');
        clearSelect(yearEl, '-- ×§×•×“× ×‘×—×¨ ×“×’× --');
        enable(yearEl, false);

        const modelsObj = (carModelsData && carModelsData[make]) ? carModelsData[make] : null;
        if (!modelsObj || typeof modelsObj !== 'object') {
          enable(modelEl, false);
          return;
        }

        const models = Object.keys(modelsObj).sort();
        if (models.length === 0) {
          enable(modelEl, false);
          return;
        }

        clearSelect(modelEl, '×‘×—×¨ ×“×’×...');
        models.forEach(m => {
          const o = document.createElement('option');
          o.value = m; o.textContent = m;
          modelEl.appendChild(o);
        });
        enable(modelEl, true);
      }

      function populateYearsForMakeModel(make, model) {
        clearSelect(yearEl, '-- ×§×•×“× ×‘×—×¨ ×“×’× --');

        const yearsArr =
          carModelsData && carModelsData[make] && Array.isArray(carModelsData[make][model])
            ? carModelsData[make][model]
            : (carModelsData && carModelsData[make] && carModelsData[make][model] && typeof carModelsData[make][model] === 'object' && carModelsData[make][model].years
                ? carModelsData[make][model].years
                : null);

        if (!yearsArr || yearsArr.length === 0) {
          enable(yearEl, false);
          return;
        }

        clearSelect(yearEl, '×‘×—×¨ ×©× ×ª×•×Ÿ...');
        // ×¡×™×“×•×¨ ×™×•×¨×“ ××• ×¢×•×œ×” â€“ × × ×™×— ×™×•×¨×“
        yearsArr.slice().sort((a,b)=>b-a).forEach(y => {
          const o = document.createElement('option');
          o.value = y; o.textContent = y;
          yearEl.appendChild(o);
        });
        enable(yearEl, true);
      }

      if (makeEl) {
        makeEl.addEventListener('change', function () {
          const make = this.value;
          if (!make) {
            clearSelect(modelEl, '-- ×§×•×“× ×‘×—×¨ ×™×¦×¨×Ÿ --');
            clearSelect(yearEl, '-- ×§×•×“× ×‘×—×¨ ×“×’× --');
            enable(modelEl, false);
            enable(yearEl, false);
            return;
          }
          populateModelsForMake(make);
        });
      }

      if (modelEl) {
        modelEl.addEventListener('change', function () {
          const make = makeEl ? makeEl.value : '';
          const model = this.value;
          if (!make || !model) {
            clearSelect(yearEl, '-- ×§×•×“× ×‘×—×¨ ×“×’× --');
            enable(yearEl, false);
            return;
          }
          populateYearsForMakeModel(make, model);
        });
      }

      // ×× ×”×©×¨×ª ××—×–×™×¨ ×™×¦×¨×Ÿ ×›×‘×¨ × ×‘×—×¨ (××¦×‘ ×—×–×¨×” ××“×©×‘×•×¨×“ ×•×›×•') â€“ ××¤×©×¨ ×œ××ª×—×œ
      // (×œ× ×—×•×‘×”; ×”×©××¨×ª×™ ×¤×©×•×˜ ×›×“×™ ×©×œ× ×™×¤×¨×™×¢).

      // Submit (×“×•×’××”; ×× ×™×© ×œ×š /analyze ×‘Ö¾Flask, ×©× ×” ×‘×”×ª××)
      const form = document.getElementById('car-form');
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const legalOk = document.getElementById('legal-confirm')?.checked;
          const legalErr = document.getElementById('legal-error');
          if (!legalOk) {
            if (legalErr) legalErr.classList.remove('hidden');
            return;
          } else {
            if (legalErr) legalErr.classList.add('hidden');
          }

          const btn = document.getElementById('submit-button');
          const spinner = btn?.querySelector('.spinner');
          const btnText = btn?.querySelector('.button-text');
          if (spinner) spinner.classList.remove('hidden');
          if (btnText) btnText.textContent = '×× ×ª×—...';

          const payload = {
            make: makeEl?.value || '',
            model: modelEl?.value || '',
            year: yearEl?.value || '',
            mileage_range: document.getElementById('mileage_range')?.value || '',
            fuel_type: document.getElementById('fuel_type')?.value || '',
            transmission: document.getElementById('transmission')?.value || '',
            sub_model: document.getElementById('sub_model')?.value || ''
          };

          try {
            const res = await fetch('/analyze', {
              method: 'POST',
              headers: { 'Content-Type':'application/json' },
              body: JSON.stringify(payload)
            });
            const data = await res.json();

            const container = document.getElementById('results-container');
            const content = document.getElementById('results-content');
            if (container && content) {
              content.innerHTML = data.html || `<pre class="whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</pre>`;
              container.classList.remove('hidden');
              container.scrollIntoView({ behavior:'smooth', block:'start' });
            }
          } catch (err) {
            const container = document.getElementById('results-container');
            const content = document.getElementById('results-content');
            if (container && content) {
              content.innerHTML = `<div class="text-red-300">×©×’×™××” ×‘×¢×™×‘×•×“ ×”×‘×§×©×”. × ×¡×” ×©×•×‘.</div>`;
              container.classList.remove('hidden');
            }
            console.error(err);
          } finally {
            if (spinner) spinner.classList.add('hidden');
            if (btnText) btnText.textContent = 'ğŸš€ ×”×¤×¢×œ ×× ×•×¢ × ×™×ª×•×— AI';
          }
        });
      }
    })();
  </script>
</body>
</html>
