<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚗 Car Reliability Analyzer</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header>
        <div class="user-corner">
            {% if user.is_authenticated %}
                <span>שלום, {{ user.name.split(' ')[0] if user.name else 'משתמש' }}</span>
                <a href="/dashboard" class="user-button">החיפושים שלי</a>
                <a href="/logout" class="user-button logout">התנתק</a>
            {% else %}
                <a href="/login" class="user-button login">התחבר עם גוגל</a>
            {% endif %}
        </div>

        <div class="header-content">
            <h1>🚗 Car Reliability Analyzer</h1>
            <p>בדיקת אמינות רכב בישראל (Gemini + Flask)</p>
        </div>
    </header>

    <main>
        {% if not user.is_authenticated %}
        <div class="login-prompt">
            <h3>ברוך הבא!</h3>
            <p>כדי לבצע חיפושים, עליך להתחבר עם חשבון גוגל.</p>
            <a href="/login" class="user-button login" style="font-size: 1.05rem; padding: 0.7rem 1.2rem;">התחבר עם גוגל</a>
        </div>

        <form id="car-form" class="hidden" aria-hidden="true">
        {% else %}
        <form id="car-form">
        {% endif %}
            <h3>🔍 בחירת רכב</h3>

            <div class="form-grid-3">
                <div class="form-group">
                    <label for="make">יצרן:</label>
                    <select id="make" name="make" required>
                        <option value="">בחר יצרן...</option>
                        {% for make in car_models_data.keys()|sort %}
                            <option value="{{ make }}">{{ make }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="model">דגם:</label>
                    <select id="model" name="model" required disabled>
                        <option value="">בחר יצרן תחילה...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="year">שנת הרכב:</label>
                    <select id="year" name="year" required disabled>
                        <option value="">בחר דגם תחילה...</option>
                    </select>
                </div>
            </div>

            <h3>📋 פרטים נוספים</h3>
            <div class="form-grid-3">
                <div class="form-group">
                    <label for="mileage_range">טווח קילומטראז':</label>
                    <select id="mileage_range" name="mileage_range">
                        <option>עד 50,000 ק"מ</option>
                        <option>50,000 - 100,000 ק"מ</option>
                        <option selected>100,000 - 150,000 ק"מ</option>
                        <option>150,000 - 200,000 ק"מ</option>
                        <option>200,000+ ק"מ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fuel_type">סוג דלק:</label>
                    <select id="fuel_type" name="fuel_type">
                        <option selected>בנזין</option>
                        <option>דיזל</option>
                        <option>היברידי</option>
                        <option>חשמלי</option>
                        <option>אחר</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="transmission">תיבת הילוכים:</label>
                    <select id="transmission" name="transmission">
                        <option selected>אוטומטית</option>
                        <option>ידנית</option>
                    </select>
                </div>
            </div>

            <div class="form-group" style="margin-top: 1rem;">
                <label for="sub_model">תת-דגם (אופציונלי):</label>
                <input type="text" id="sub_model" name="sub_model" placeholder="לדוגמה: 'Lounge', '1.6 ליטר', 'GLI'">
            </div>

            <!-- ✅ אישור גיל והסכמה לתנאי שימוש -->
            <div class="form-group" style="margin-top: 1.5rem;">
                <label>
                    <input type="checkbox" id="legal-confirm" name="legal-confirm" required>
                    אני מצהיר/ה כי אני בן/בת 18 ומעלה, קראתי והסכמתי ל-
                    <a href="{{ url_for('terms') }}" target="_blank">תקנון השימוש</a> ול-
                    <a href="{{ url_for('privacy') }}" target="_blank">מדיניות הפרטיות</a>.
                </label>
                <p id="legal-error" style="color: #b91c1c; font-size: 0.85rem; display: none; margin-top: 0.5rem;">
                    ⚠️ חובה לאשר את הסעיף כדי להמשיך.
                </p>
            </div>

            <button type="submit" id="submit-button">
                <span class="button-text">🚀 בצע ניתוח אמינות</span>
                <div class="spinner hidden" aria-hidden="true"></div>
            </button>
        </form>

        <div id="results-container" class="hidden">
            <div id="results-content"></div>
        </div>
    </main>

    <footer style="text-align: center; padding: 20px; margin-top: 50px; border-top: 1px solid #eee; font-size: 0.9em;">
        <p>&copy; 2025 ידע רכב (yedaarechev). כל הזכויות שמורות.</p>
        <p style="margin-top: 10px;">
            <a href="{{ url_for('privacy') }}" style="margin: 0 10px; color: #0d6efd; text-decoration: none;">מדיניות פרטיות</a> | 
            <a href="{{ url_for('terms') }}" style="margin: 0 10px; color: #0d6efd; text-decoration: none;">תקנון שימוש</a>
        </p>
    </footer>

    <script>
        const userIsAuthenticated = {{ user.is_authenticated | tojson }};
        const carModelsData = {{ car_models_data | tojson }};
    </script>
    <script src="/static/script.js"></script>
</body>
</html>
